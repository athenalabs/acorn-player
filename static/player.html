<!DOCTYPE html>
<html lang="en">
<!--

player.html: renders acorns in real time

How to use:

1. setup a web-server on the acorn-player root:

    .../acorn-player % python -m SimpleHTTPServer

2. GET /static/player.html

    http://localhost:8000/static/player.html

3. The fields trigger on blur

-->
<head>
  <meta charset="UTF-8">

  <title>acorn-player</title>
  <link rel="shortcut icon" href="/img/favicon.ico">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script src="/node_modules/jquery-browser/lib/jquery.js"></script>
  <script src="/node_modules/underscore/underscore.js"></script>
  <script src="/node_modules/backbone/backbone.js"></script>
  <script src="/lib/jquery/jquery.object-fit.js"></script>
  <script src="/node_modules/grunt-jasmine-spec-server/lib/bootstrap/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="/node_modules/grunt-jasmine-spec-server/lib/bootstrap/css/bootstrap.min.css">


  <link rel="stylesheet" href="/static/css/acorn-player.css" />

  <script src="/lib/athena.lib.min.js"></script>
  <script src="/build/acornplayer.min.js"></script>

  <script type="text/javascript">

  var player;

  var showAcorn = function(acornModel) {
    if (player && player.view)
      player.view.destroy();

    $('#acorndata').val(JSON.stringify(acornModel.toJSON(), null, 2));
    $('input#acornid').val(acornModel.acornid());

    player = new acorn.player.Player({acornModel: acornModel});
    player.view.render();
    $('.acorn-player-container').append(player.view.el);
  };

  var loadAcorn = function() {
    var acornid = $('input#acornid').val().trim();
    console.log('looking up acornid:' + acornid);

    var acornModel = acorn(acornid);
    acornModel.fetch({
      success: function() {
        console.log(acornModel.toJSON());
        showAcorn(acornModel);
      },
      error: function() {
        console.log('error');
      }
    });
  };

  var rewriteAcorn = function() {
    var data = $('#acorndata').val();
    data = JSON.parse(data);
    console.log("constructing acorn: ");
    console.log(data);

    var acornModel = acorn(data);
    showAcorn(acornModel);
  };

  $(document).ready(function() {
    rewriteAcorn();

    $('input#acornid').blur(loadAcorn);
    $('#acorndata').blur(rewriteAcorn);
  });

  </script>


  <style>
  body {
    text-align: center;
  }

  input#acornid {
    margin-top: 100px;
    margin-bottom: 100px;
    text-align: center;
    font-weight: bold;
  }

  .acorn-player-container {
    margin: 0 auto;
    width: 600px;
    height: 400px;
  }

  .acorn-player {
    width: 600px;
    height: 400px;
  }

  textarea#acorndata {
    margin-top: 100px;
    margin-bottom: 100px;
    width: 600px;
    height: 400px;
    font-family: Monaco;
    font-size: 10pt;
  }
  </style>

</head>
<body>

<div class="container">
  <div class="span12" id="box">

    <input type="text" id="acornid" placeholder="acornid" value="" />
    <div class="acorn-player-container"></div>
    <textarea id="acorndata" placeholder="acorn data">
{
  "shell": {
    "shellid": "acorn.Shell"
  },
  "acornid": "new",
  "thumbnail": "http://acorn.athena.ai/img/acorn.png"
}
    </textarea>

  </div>
</div>
</body>
</html>
